---
title: "程序调试过程"
date: 2023-10-09T20:06:10+08:00
---

假设您编写了一个程序，但它不能正常工作。代码编译通过，但当您运行它时，您得到的结果不正确。你肯定在什么地方有语义错误。你怎么能找到它？如果您一直在通过编写一点代码然后测试它，遵循最佳实践，那么您可能会很清楚错误在哪里，或者根本不知道。

所有的错误都源于一个简单的前提：你认为正确的东西，实际存在问题。实际上，找出错误在哪里是具有挑战性的。在本课中，我们将概述调试程序的一般过程。

因为我们还没有涵盖那么多C++主题，所以本章中的示例程序将非常基础。这可能会使我们在这里展示的一些技术显得超出我们目前的需求。然而，请记住，这些技术旨在与更大、更复杂的程序一起使用，并且在那些场景中更有用（这是您最需要它们的地方）。

***
## 调试的一般方法

一旦发现问题，调试问题通常包括五个步骤：

Find the root cause of the problem (usually the line of code that’s not working)
Ensure you understand why the issue is occurring
Determine how you’ll fix the issue
Repair the issue causing the problem
Retest to ensure the problem has been fixed and no new problems have emerged

让我们在这里使用一个真实的类比。比方说，有一天晚上，你去冰箱的自动售冰机里买些冰。你把杯子放在分配器上，按下杠杆，然后……什么也没有出来。哦哦。你发现了某种缺陷。你会怎么做？您可能会开始调查，看看是否可以确定问题的根本原因。

找出根本原因：因为你听到了制冰机试图送冰，这可能不是送冰机制本身。所以你打开冰箱，检查一下冰盘。没有冰。这是问题的根本原因吗？不，这是另一个症状。在进一步检查后，您确定制冰机似乎没有在制冰。问题是制冰机还是其他什么？冰箱仍然很冷，水管没有堵塞，其他一切似乎都在工作，所以你得出结论，根本原因是制冰机不工作。

理解问题：在这种情况下，这很简单。碎冰机不会制冰。

确定修复：在这一点上，您有几个修复选项：您可以解决这个问题（从商店购买冰袋）。你可以试着进一步诊断制冰机，看看是否有可以修理的部件。你可以买一个新的制冰机，并安装它来代替目前的一个。或者你可以买一个新的冰箱。你决定买一台新的制冰机。

修复问题：一旦制冰机到达，您就可以安装它。

重新测试：在重新打开电源并等待一夜之后，您的新制冰机开始制冰。未发现新问题。

现在，让我们将此过程应用于上一课中的简单程序：

```C++
#include <iostream>

int add(int x, int y) // this function is supposed to perform addition
{
    return x - y; // but it doesn't due to the wrong operator being used
}

int main()
{
    std::cout << "5 + 3 = " << add(5, 3) << '\n'; // should produce 8, but produces 2

    return 0;
}
```

这段代码在一个方面很好：错误非常明显，因为错误的答案通过第10行打印到屏幕上。这为我们的调查提供了一个起点。

查找根本原因：在第10行，我们可以看到我们正在传递参数（5和3）的文本，因此那里没有错误的空间。由于函数add的输入是正确的，但输出是错误的，因此很明显，函数add必须产生错误的值。函数add中唯一的语句是return语句，它必须是罪魁祸首。我们找到了问题线。现在我们知道了应该将注意力集中在哪里，注意到我们是在减法而不是加法，这是通过检查很可能会发现的。

理解问题：在这种情况下，很明显，为什么生成了错误的值——我们使用了错误的操作符。

确定修复：我们将简单地将operator-更改为operator+。

修复问题：这实际上是将operator-更改为operator+，并确保程序重新编译。

重新测试：在实现更改后，重新运行程序将指示我们的程序现在产生正确的值8。对于这个简单的程序，这就是所需的所有测试。

这个例子很小，但说明了诊断任何程序时要经历的基本过程。

***