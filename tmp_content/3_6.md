---
title: "使用集成调试器：运行和断点"
date: 2023-10-09T20:06:10+08:00
---

虽然单步执行（在第3.6课中介绍——使用集成调试器：单步执行）对于孤立地检查代码的每一行很有用，但在大型程序中，单步执行代码甚至可能需要很长时间才能到达您想要更详细地检查的点。

幸运的是，现代调试器提供了更多的工具来帮助我们有效地调试程序。在本课中，我们将研究一些调试器功能，这些功能使我们能够更快地导航代码。

***
## 运行到光标

第一个有用的命令通常称为Run-to-cursor。此Run-to-cursor命令执行程序，直到执行到达游标选择的语句。然后它将控制权返回给您，以便您可以从该点开始调试。这为在代码中的特定点开始调试提供了一种有效的方法，或者，如果已经在调试，则直接移动到要进一步检查的位置。

让我们使用我们一直在使用的相同程序来尝试：

```C++
#include <iostream>

void printValue(int value)
{
    std::cout << value << '\n';
}

int main()
{
    printValue(5);

    return 0;
}
```

只需右键单击第5行的任意位置，然后选择“Runtocursor”。

您将注意到程序开始运行，执行标记移动到您刚才选择的行。您的程序已经执行到这一点，现在正在等待进一步的调试命令。从这里，您可以单步执行您的程序，将光标运行到不同的位置，等等…

若您将游标运行到一个不执行的位置，那个么运行到游标将简单地运行您的程序，直到终止。

{{< alert success >}}
**对于Visual Studio用户**

在Visual Studio中，通过右键单击代码中的语句并从上下文菜单中选择run to cursor，或者按ctrl-F10键盘组合键，可以访问run to cursor命令。

{{< /alert >}}

{{< alert success >}}
**对于代码：：阻止用户**

在代码：：块中，通过右键单击代码中的语句并从关联菜单或调试菜单中选择运行到光标，或按F4快捷键，可以访问运行到光标命令。

{{< /alert >}}

{{< alert success >}}
**对于VS代码用户**

在VS代码中，通过右键单击代码中的语句并从上下文菜单中选择run to cursor，可以在已经调试程序的情况下访问run to cursor命令。

{{< /alert >}}

***
## 继续（C）

一旦您处于调试会话的中间，您可能希望只从该点开始运行程序。最简单的方法是使用continue命令。continue-debug命令只是按照正常方式继续运行程序，要么直到程序终止，要么直到有东西触发控件再次返回给您（例如断点，我们将在本课后面介绍）。

让我们测试一下continue命令。如果您的执行标记不在第5行上，请运行光标到第5行。然后从该点选择“继续”。您的程序将完成执行，然后终止。

{{< alert success >}}
**对于Visual Studio用户**

在Visual Studio中，在已经调试程序的情况下，可以通过“调试”菜单>“继续”或按F5快捷键来访问continue命令。

{{< /alert >}}

{{< alert success >}}
**对于代码：：阻止用户**

在代码：：块中，可以通过调试菜单>开始/继续或按F8快捷键，在已经调试程序的情况下访问继续命令。

{{< /alert >}}

{{< alert success >}}
**对于VS代码用户**

在VS代码中，通过“运行”菜单>“继续”或按F5快捷键，可以在调试程序时访问继续命令。

{{< /alert >}}

***
## 开始

continue命令有一个名为start的孪生兄弟。start命令执行与continue相同的操作，只是从程序的开头开始。它只能在尚未处于调试会话中时调用。

如果在上面的示例程序上使用start命令，它将一直运行，不会中断（VS代码除外，因为我们在上一课中设置了stopAtEntry:true）。虽然这看起来不起眼，但这只是因为我们没有告诉调试器中断程序。在下一节中，我们将更好地使用该命令。

{{< alert success >}}
**对于Visual Studio用户**

在Visual Studio中，在不调试程序时，可以通过“调试”菜单>“开始调试”或按F5快捷键来访问启动命令。

{{< /alert >}}

{{< alert success >}}
**对于代码：：阻止用户**

在代码：：块中，可以通过“调试”菜单>“开始/继续”或按F8快捷键在不调试程序的情况下访问启动命令。

{{< /alert >}}

{{< alert success >}}
**对于VS代码用户**

在VS代码中，可以通过“运行”菜单>“开始调试”或按F5快捷键在不调试程序时访问启动命令。

{{< /alert >}}

***
## 断点

我们将在本节中讨论的最后一个主题是断点。断点是一个特殊的标记，它告诉调试器在调试模式下运行时，在断点处停止程序的执行。

设置断点时，您将看到出现一种新类型的图标。Visual Studio使用红色圆圈，代码：：块使用红色八角形（类似于停止符号）：

继续，在第5行上设置一个断点，如上图所示。

现在，选择Start命令让调试器运行代码，让我们看看断点的作用。您将注意到，调试器不是一直运行到程序的末尾，而是在断点处停止（执行标记位于断点图标的顶部）：

这就好像您将运行光标到这一点。

与游标运行相比，断点有几个优点。首先，断点将导致调试器在每次遇到它们时都将控制权返回给您（与运行到游标不同，每次调用游标时，它只对游标运行一次）。其次，您可以设置断点，它将一直存在，直到您删除它为止，而使用run-to-cursor，您必须在每次调用命令时定位要运行到的位置。

请注意，放置在不在执行路径中的行上的断点不会导致调试器停止代码的执行。

让我们来看一个稍微修改的程序，它更好地说明了断点和运行到光标之间的区别：

```C++
#include <iostream>

void printValue(int value)
{
    std::cout << value << '\n';
}

int main()
{
    printValue(5);
    printValue(6);
    printValue(7);

    return 0;
}
```

首先，启动一个新的调试会话，然后运行光标到第5行。现在选择“继续”。程序将继续到末尾（它不会再次在第5行停止，即使第5行再执行两次）。

接下来，在第5行上放置一个断点，然后选择start。程序将在第5行停止。现在选择“继续”。程序将在第5行再次停止。再次选择“继续”，它将第三次停止。再继续一次，程序将终止。可以看到，断点导致程序停止的次数与该行的执行次数相同。

{{< alert success >}}
**对于Visual Studio用户**

在Visual Studio中，可以通过“调试”菜单>“切换断点”来设置或删除断点，或者通过右键单击语句并从上下文菜单中选择“切换断口”，或者通过按F9快捷键，或者通过单击行号的左侧（在浅灰色区域中）来设置或移除断点。

{{< /alert >}}

{{< alert success >}}
**对于代码：：阻止用户**

在代码：：块中，可以通过调试菜单>切换断点来设置或删除断点，或者通过右键单击语句并从上下文菜单中选择切换断点，或通过按F5快捷键，或通过单击行号右侧来设置或移除断点。

{{< /alert >}}

{{< alert success >}}
**对于VS代码用户**

在VS代码中，可以通过“运行”菜单>“切换断点”，或按F9快捷键，或单击行号左侧来设置或删除断点。

{{< /alert >}}

***
## 设置下一条语句

还有一个调试命令使用得相当罕见，但至少仍然值得了解，即使您不会经常使用它。setnext语句命令允许我们将执行点更改为其他语句（有时非正式地称为跳跃）。这可以用于向前跳转执行点并跳过一些本来会执行的代码，或者向后跳转，使已经执行的代码再次运行。

让我们看看向前跳的动作：

```C++
#include <iostream>

void printValue(int value)
{
    std::cout << value << '\n';
}

int main()
{
    printValue(5);
    printValue(6);
    printValue(7);

    return 0;
}
```

首先，运行光标到第11行。此时，您应该在控制台输出窗口中看到值5。

现在，右键单击第12行，并选择setnext语句。这导致跳过第11行，而不执行。然后选择“继续”以完成程序的执行。

程序的输出应如下所示：

我们可以看到printValue（6）被跳过。

此功能在几种情况下都很有用。

在我们对基本调试技术的探索中，我们讨论了注释函数，作为确定该函数是否在引发问题中起作用的一种方法。这需要修改我们的代码，并记住稍后取消注释该函数。在调试器中，没有直接的方法跳过函数，因此如果您决定要这样做，那么使用setnext语句跳过函数调用是最简单的方法。

如果我们想观察刚刚执行的函数再次运行，那么向后跳转也很有用，这样我们可以看到它在做什么。

使用上面的相同代码，运行到游标到第12行。然后在第11行设置下一个语句，并继续。程序的输出应为：

{{< alert success >}}
**对于Visual Studio用户**

在Visual Studio中，通过右键单击语句并从上下文菜单中选择Set next statement，或按Ctrl-Shift-F10快捷组合，可以跳过执行点。此选项是上下文选项，仅在已经调试程序时发生。

{{< /alert >}}

{{< alert success >}}
**对于代码：：阻止用户**

在Code:：Blocks中，可以通过Debug菜单>Set next语句跳转执行点，或者右键单击语句并从上下文菜单中选择Set next statement。代码：：块没有此命令的键盘快捷方式。

{{< /alert >}}

{{< alert success >}}
**对于VS代码用户**

在VSCode中，您可以通过右键单击语句并从上下文菜单中选择Jumptocursor来跳转执行点。此选项是上下文选项，仅在已经调试程序时发生。

{{< /alert >}}

{{< alert success >}}
**警告**

set next语句命令将更改执行点，但不会更改程序状态。变量将保留它们在跳转之前的任何值。因此，跳转可能会导致程序产生与其他情况不同的值、结果或行为。明智地使用此功能（特别是向后跳）。

{{< /alert >}}

{{< alert success >}}
**警告**

不应使用set-next语句将执行点更改为其他函数。这可能导致未定义的行为，并可能导致崩溃。

{{< /alert >}}

***
## 结论

现在，您了解了使用集成调试器来监视和控制程序执行方式的主要方法。虽然这些命令对于诊断代码流问题（例如，确定是否调用某些函数）很有用，但它们只是集成调试器带来的好处的一部分。在下一课中，我们将开始探索检查程序状态的其他方法，您需要将这些命令作为前提条件。我们走吧！

