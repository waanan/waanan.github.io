---
title: "对于报表"
date: 2024-01-02T10:33:49+08:00
---

到目前为止，C++中使用最多的循环语句是for语句。当我们有一个明显的循环变量时，for语句（也称为for循环）是首选的，因为它允许我们轻松而简洁地定义、初始化、测试和更改循环变量的值。

从C++11开始，有两种不同的for循环。在本课程中，我们将介绍经典的for语句，在以后的课程中，在介绍了一些其他先决主题（如数组和迭代器）后，将介绍新的基于范围的for语句（16.7——基于范围的循环（每个循环））。



for语句在抽象上看起来相当简单：

最初理解for语句如何工作的最简单方法是将其转换为等效的while语句：

***
## 对报表的评估

A for语句由3部分计算：

首先，执行init语句。这仅在循环启动时发生一次。init语句通常用于变量定义和初始化。这些变量具有“循环范围”，这实际上只是块范围的一种形式，其中这些变量从定义点一直存在到循环语句的末尾。在我们的while循环等价物中，可以看到init语句位于包含循环的块内，因此当包含循环的模块结束时，init语句中定义的变量超出范围。

其次，对于每个循环迭代，评估条件。如果它的计算结果为true，则执行该语句。如果该值为false，则循环终止，并继续执行循环之外的下一条语句。

最后，在执行语句之后，计算结束表达式。通常，该表达式用于递增或递减init语句中定义的循环变量。在结束表达式求值之后，执行返回到第二步（并再次求值条件）。

让我们来看一个循环示例，并讨论它的工作原理：

```C++
#include <iostream>

int main()
{
    for (int i{ 1 }; i <= 10; ++i)
        std::cout << i << ' ';

    std::cout << '\n';

    return 0;
}
```

首先，我们声明一个名为i的循环变量，并用值1对其进行初始化。

其次，计算i<=10，因为i是1，所以它的计算结果为true。因此，执行语句，输出1和空格。

最后，计算++i，将i增加到2。然后循环返回到第二步。

现在，再次计算i<=10。由于我的值为2，因此它的计算结果为true，因此循环再次迭代。该语句打印2和一个空格，i递增为3。循环继续迭代，直到最终i增加到11，此时i<=10的计算结果为false，循环退出。

因此，该程序打印结果：

为了示例起见，让我们将上面的For循环转换为等效的while循环：

```C++
#include <iostream>

int main()
{
    { // the block here ensures block scope for i
        int i{ 1 }; // our init-statement
        while (i <= 10) // our condition
        {
            std::cout << i << ' '; // our statement
            ++i; // our end-expression
        }
    }

    std::cout << '\n';
}
```

看起来没那么糟吧？注意，这里需要外部大括号，因为当循环结束时，我超出了范围。

对于新程序员来说，循环可能很难阅读——然而，有经验的程序员喜欢它们，因为它们是使用计数器进行循环的一种非常紧凑的方法，并且预先提供了关于循环变量、循环条件和循环变量修饰符的所有必要信息。这有助于减少错误。

***
## 更多for循环示例

下面是使用for循环计算整数指数的函数的示例：

```C++
#include <cstdint> // for fixed-width integers

// returns the value base ^ exponent -- watch out for overflow!
std::int64_t pow(int base, int exponent)
{
    std::int64_t total{ 1 };

    for (int i{ 0 }; i < exponent; ++i)
        total *= base;

    return total;
}
```

此函数返回值base^index（基数为指数幂）。

这是一个简单的for循环递增，其中i从0循环到（但不包括）指数。

如果指数为0，for循环将执行0次，函数将返回1。如果指数为1，for循环将执行1次，函数将返回1*base。如果指数为2，for循环将执行2次，函数将返回1*base*base。

尽管大多数for循环将循环变量增加1，但我们也可以将其减少：

```C++
#include <iostream>

int main()
{
    for (int i{ 9 }; i >= 0; --i)
        std::cout << i << ' ';

    std::cout << '\n';

    return 0;
}
```

这将打印结果：

或者，我们可以在每次迭代中将循环变量的值更改1以上：

```C++
#include <iostream>

int main()
{
    for (int i{ 0 }; i <= 10; i += 2) // increment by 2 each iteration
        std::cout << i << ' ';

    std::cout << '\n';

    return 0;
}
```

这将打印结果：

***
## 操作员的危险！=在for循环条件中

在编写涉及值的循环条件时，我们通常可以用许多不同的方法编写条件。以下两个循环执行相同：

```C++
#include <iostream>

int main()
{
    for (int i { 0 }; i < 10; ++i) // uses <
         std::cout << i;

    for (int i { 0 }; i != 10; ++i) // uses !=
         std::cout << i;

     return 0;
}
```

那么我们应该选择哪一个呢？前者是更好的选择，因为即使我跳过值10，它也会终止，而后者不会。下面的示例演示了这一点：

```C++
#include <iostream>

int main()
{
    for (int i { 0 }; i < 10; ++i) // uses <, still terminates
    {
         std::cout << i;
         if (i == 9) ++i; // jump over value 10
    }

    for (int i { 0 }; i != 10; ++i) // uses !=, infinite loop
    {
         std::cout << i;
         if (i == 9) ++i; // jump over value 10
    }

     return 0;
}
```

{{< alert success >}}
**最佳做法**

避免运算符！=在for循环条件中进行数值比较时。

{{< /alert >}}

***
## Off-by-one错误

对于for循环（以及使用计数器的其他循环），新程序员面临的最大问题之一是一个错误。当循环迭代一次太多或一次太少以产生所需的结果时，会发生逐点错误。

下面是一个示例：

```C++
#include <iostream>

int main()
{
    // oops, we used operator< instead of operator<=
    for (int i{ 1 }; i < 5; ++i)
    {
        std::cout << i << ' ';
    }

    std::cout << '\n';

    return 0;
}
```

这个程序应该打印12345，但它只打印1234，因为我们使用了错误的关系运算符。

尽管这些错误的最常见原因是使用了错误的关系运算符，但它们有时可以通过使用预增量或预减量而不是后增量或后减量来发生，反之亦然。

***
## 省略的表达式

可以为省略任何或所有语句或表达式的循环编写。例如，在下面的示例中，我们将省略init语句和end表达式，只保留条件：

```C++
#include <iostream>

int main()
{
    int i{ 0 };
    for ( ; i < 10; ) // no init-statement or end-expression
    {
        std::cout << i << ' ';
        ++i;
    }

    std::cout << '\n';

    return 0;
}
```

此for循环产生以下结果：

我们不是让for循环进行初始化和增量，而是手动完成。在本例中，我们这样做纯粹是出于学术目的，但在某些情况下，需要不声明循环变量（因为您已经有了一个）或不在结束表达式中增加它（因为您以其他方式增加它）。

尽管您并不经常看到它，但值得注意的是，下面的示例生成了无限循环：

```C++
for (;;)
    statement;
```

上述示例相当于：

```C++
while (true)
    statement;
```

这可能有点出乎意料，因为您可能希望省略的条件表达式被视为false。然而，C++标准显式（并且不一致）定义了for循环中省略的条件表达式应被视为true。

我们建议完全避免这种形式的for循环，而是使用while（true）。

***
## 对于具有多个计数器的循环

尽管for循环通常仅在一个变量上迭代，但有时for循环需要处理多个变量。为了帮助实现这一点，程序员可以在init语句中定义多个变量，并可以使用逗号操作符来更改结束表达式中多个变量的值：

```C++
#include <iostream>

int main()
{
    for (int x{ 0 }, y{ 9 }; x < 10; ++x, --y)
        std::cout << x << ' ' << y << '\n';

    return 0;
}
```

该循环定义并初始化两个新变量：x和y。它在0到9的范围内迭代x，每次迭代后x递增，y递减。

该程序生成结果：

这是C++中唯一一个在同一语句中定义多个变量，并且使用逗号运算符被认为是可以接受的做法。

{{< alert success >}}
**最佳做法**

在for语句中定义多个变量（在init语句中）并使用逗号运算符（在结束表达式中）是可以接受的。

{{< /alert >}}

***
## 为循环嵌套

与其他类型的循环一样，for循环可以嵌套在其他循环中。在下面的示例中，我们将for循环嵌套在另一个for循环中：

```C++
#include <iostream>

int main()
{
	for (char c{ 'a' }; c <= 'e'; ++c) // outer loop on letters
	{
		std::cout << c; // print our letter first
		
		for (int i{ 0 }; i < 3; ++i) // inner loop on all numbers
			std::cout << i;

		std::cout << '\n';
	}

	return 0;
}
```

对于外部循环的每次迭代，内部循环都会完整地运行。因此，输出为：

下面是关于这里发生的事情的更多细节。外部循环首先运行，char c被初始化为“a”。然后计算c<=“e”，这是真的，因此执行循环体。由于c被设置为“a”，因此首先打印a。然后，内部循环完全执行（它打印0、1和2）。然后打印换行符。现在，外部循环体完成了，因此外部循环返回顶部，c增加到“b”，并重新计算循环条件。由于循环条件仍然为true，因此开始外部循环的下一次迭代。这将打印b012\n。等等。

***
## 结论

For语句是C++语言中最常用的循环。尽管它的语法对于新程序员来说通常有点混乱，但您会经常看到for循环，以至于您很快就会理解它们！

对于语句，当您有计数器变量时，会出现excel。如果没有计数器，则while语句可能是更好的选择。

{{< alert success >}}
**最佳做法**

当存在明显的循环变量时，优先于while循环。当没有明显的循环变量时，首选while循环而不是循环。

{{< /alert >}}

***
## 测验时间

问题#1

编写一个for循环，以打印0到20之间的每个偶数。

显示解决方案

问题#2

编写名为sumTo（）的函数，该函数接受名为value的整数参数，并返回从1到value的所有数字的总和。

例如，sumTo（5）应该返回15，即1+2+3+4+5。

提示：在从1迭代到输入值时，使用非循环变量累加总和，就像上面的pow（）示例使用total变量来累加每次迭代的返回值一样。

显示解决方案

问题#3

下面的for循环有什么问题？

```C++
// Print all numbers from 9 to 0
for (unsigned int i{ 9 }; i >= 0; --i)
    std::cout << i<< ' ';
```

显示解决方案

问题#4

FizzBuzz是一款简单的数学游戏，用于教孩子关于可分性的知识。它有时也被用作评估基本编程技能的面试问题。

游戏规则很简单：从1开始，向上计数，将任何只能被3整除的数字替换为单词“fizz”，任何只能被5整除的数替换为单词”buzz“，任何既可以被3整掉又可以被5整掉的数替换成单词”fizzbuzz”。

在名为fizzbuzz（）的函数中实现此游戏，该函数采用一个参数来确定要计数的数字。使用for循环和单个if-else链（这意味着您可以根据需要使用任意多的其他链）。

嘶嘶声（15）的输出应匹配以下内容：

显示解决方案

问题#5

修改您在上一次测验中编写的FizzBuzz程序，添加可被7整除的数字应替换为“pop”的规则。运行程序150次迭代。

在此版本中，使用if/else链将导致函数过长。优化函数，使其每除数只使用一个if语句。

显示提示

下面是预期输出的一些片段：

显示解决方案

